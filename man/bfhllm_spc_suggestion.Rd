% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/spc-suggestions.R
\name{bfhllm_spc_suggestion}
\alias{bfhllm_spc_suggestion}
\title{Generate SPC Improvement Suggestion}
\usage{
bfhllm_spc_suggestion(
  spc_result,
  context,
  max_chars = 350,
  use_rag = TRUE,
  cache = NULL,
  ...
)
}
\arguments{
\item{spc_result}{List from BFHcharts/qicharts2 with metadata and qic_data}

\item{context}{Named list with user context:
\itemize{
\item data_definition: Indicator description (character)
\item chart_title: Chart title (character)
\item y_axis_unit: Unit of measurement (e.g., "dage", "antal", "procent")
\item target_value: Target value (numeric, optional)
}}

\item{max_chars}{Maximum characters in response (default: 350)}

\item{use_rag}{Logical, use RAG for SPC methodology context (default: TRUE)}

\item{cache}{Cache object from bfhllm_cache_create() or bfhllm_cache_shiny() (optional)}

\item{...}{Additional arguments passed to bfhllm_chat() (model, timeout, etc.)}
}
\value{
Character string with AI-generated improvement suggestion in Danish,
or NULL on error
}
\description{
Main function for generating AI-powered improvement suggestions for SPC charts.
Combines metadata extraction, RAG context retrieval, prompt building, and
LLM generation into a single high-level interface.
}
\details{
\strong{Workflow:}
\enumerate{
\item Extract SPC metadata from result object
\item Query RAG knowledge store (if use_rag = TRUE)
\item Build structured prompt with metadata + context + RAG
\item Call LLM via bfhllm_chat()
\item Validate and return response
}

\strong{Caching:}
If cache provided, checks cache before API call and stores result after.
Cache key includes metadata, context, and RAG content for uniqueness.

\strong{RAG Integration:}
When use_rag = TRUE, queries knowledge store for relevant SPC methodology
based on chart type, signals detected, and target comparison.
}
\examples{
\dontrun{
# Basic usage
spc_result <- BFHcharts::create_spc_chart(data, ...)
context <- list(
  data_definition = "Ventetid til operation",
  chart_title = "Ventetid ortopÃ¦dkirurgi 2024",
  y_axis_unit = "dage",
  target_value = 30
)

suggestion <- bfhllm_spc_suggestion(spc_result, context)

# With caching (Shiny)
cache <- bfhllm_cache_shiny(session)
suggestion <- bfhllm_spc_suggestion(
  spc_result, context,
  cache = cache
)

# Without RAG
suggestion <- bfhllm_spc_suggestion(
  spc_result, context,
  use_rag = FALSE
)
}

}
